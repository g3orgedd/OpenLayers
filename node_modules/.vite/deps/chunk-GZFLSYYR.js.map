{
  "version": 3,
  "sources": ["../../ol/interaction/Link.js"],
  "sourcesContent": ["/**\n * @module ol/interaction/Link\n */\nimport EventType from '../events/EventType.js';\nimport Interaction from './Interaction.js';\nimport MapEventType from '../MapEventType.js';\nimport {listen, unlistenByKey} from '../events.js';\nimport {toFixed} from '../math.js';\n\n/**\n * @param {number} number A number.\n * @return {number} A number with at most 5 decimal places.\n */\nfunction to5(number) {\n  return toFixed(number, 5);\n}\n\n/**\n * @param {string} string A string.\n * @return {number} A number representing the string.\n */\nfunction readNumber(string) {\n  return parseFloat(string);\n}\n\n/**\n * @param {number} number A number.\n * @return {string} A string representing the number.\n */\nfunction writeNumber(number) {\n  return to5(number).toString();\n}\n\n/**\n * @param {number} a A number.\n * @param {number} b A number.\n * @return {boolean} The numbers are different.\n */\nfunction differentNumber(a, b) {\n  if (isNaN(a)) {\n    return false;\n  }\n  return a !== readNumber(writeNumber(b));\n}\n\n/**\n * @param {Array<number>} a An array of two numbers.\n * @param {Array<number>} b An array of two numbers.\n * @return {boolean} The arrays are different.\n */\nfunction differentArray(a, b) {\n  return differentNumber(a[0], b[0]) || differentNumber(a[1], b[1]);\n}\n\n/**\n * @typedef {Object} Options\n * @property {boolean|import('../View.js').AnimationOptions} [animate=true] Animate view transitions.\n * @property {boolean} [replace=false] Replace the current URL without creating the new entry in browser history.\n * By default, changes in the map state result in a new entry being added to the browser history.\n * @property {string} [prefix=''] By default, the URL will be updated with search parameters x, y, z, and r.  To\n * avoid collisions with existing search parameters that your application uses, you can supply a custom prefix for\n * the ones used by this interaction (e.g. 'ol:').\n */\n\n/**\n * @classdesc\n * An interaction that synchronizes the map state with the URL.\n *\n * @api\n */\nclass Link extends Interaction {\n  /**\n   * @param {Options} [options] Link options.\n   */\n  constructor(options) {\n    super();\n\n    options = Object.assign(\n      {animate: true, replace: false, prefix: ''},\n      options || {}\n    );\n\n    let animationOptions;\n    if (options.animate === true) {\n      animationOptions = {duration: 250};\n    } else if (!options.animate) {\n      animationOptions = null;\n    } else {\n      animationOptions = options.animate;\n    }\n\n    /**\n     * @type {import('../View.js').AnimationOptions|null}\n     * @private\n     */\n    this.animationOptions_ = animationOptions;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.replace_ = options.replace;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.prefix_ = options.prefix;\n\n    /**\n     * @private\n     * @type {!Array<import(\"../events.js\").EventsKey>}\n     */\n    this.listenerKeys_ = [];\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.initial_ = true;\n\n    this.updateState_ = this.updateState_.bind(this);\n  }\n\n  /**\n   * @private\n   * @param {string} name A parameter name.\n   * @return {string} A name with the prefix applied.\n   */\n  getParamName_(name) {\n    if (!this.prefix_) {\n      return name;\n    }\n    return this.prefix_ + name;\n  }\n\n  /**\n   * @private\n   * @param {URLSearchParams} params The search params.\n   * @param {string} name The unprefixed parameter name.\n   * @return {string|null} The parameter value.\n   */\n  get_(params, name) {\n    return params.get(this.getParamName_(name));\n  }\n\n  /**\n   * @private\n   * @param {URLSearchParams} params The search params.\n   * @param {string} name The unprefixed parameter name.\n   * @param {string} value The param value.\n   */\n  set_(params, name, value) {\n    params.set(this.getParamName_(name), value);\n  }\n\n  /**\n   * @private\n   * @param {URLSearchParams} params The search params.\n   * @param {string} name The unprefixed parameter name.\n   */\n  delete_(params, name) {\n    params.delete(this.getParamName_(name));\n  }\n\n  /**\n   * @param {import(\"../Map.js\").default|null} map Map.\n   */\n  setMap(map) {\n    const oldMap = this.getMap();\n    super.setMap(map);\n    if (map === oldMap) {\n      return;\n    }\n    if (oldMap) {\n      this.unregisterListeners_(oldMap);\n    }\n    if (map) {\n      this.initial_ = true;\n      this.updateState_();\n      this.registerListeners_(map);\n    }\n  }\n\n  /**\n   * @param {import(\"../Map.js\").default} map Map.\n   * @private\n   */\n  registerListeners_(map) {\n    this.listenerKeys_.push(\n      listen(map, MapEventType.MOVEEND, this.updateUrl_, this),\n      listen(map.getLayerGroup(), EventType.CHANGE, this.updateUrl_, this),\n      listen(map, 'change:layergroup', this.handleChangeLayerGroup_, this)\n    );\n\n    if (!this.replace_) {\n      addEventListener('popstate', this.updateState_);\n    }\n  }\n\n  /**\n   * @param {import(\"../Map.js\").default} map Map.\n   * @private\n   */\n  unregisterListeners_(map) {\n    for (let i = 0, ii = this.listenerKeys_.length; i < ii; ++i) {\n      unlistenByKey(this.listenerKeys_[i]);\n    }\n    this.listenerKeys_.length = 0;\n\n    if (!this.replace_) {\n      removeEventListener('popstate', this.updateState_);\n    }\n\n    const url = new URL(window.location.href);\n    const params = url.searchParams;\n    this.delete_(params, 'x');\n    this.delete_(params, 'y');\n    this.delete_(params, 'z');\n    this.delete_(params, 'r');\n    this.delete_(params, 'l');\n    window.history.replaceState(null, '', url);\n  }\n\n  /**\n   * @private\n   */\n  handleChangeLayerGroup_() {\n    const map = this.getMap();\n    if (!map) {\n      return;\n    }\n    this.unregisterListeners_(map);\n    this.registerListeners_(map);\n    this.initial_ = true;\n    this.updateUrl_();\n  }\n\n  /**\n   * @private\n   */\n  updateState_() {\n    const map = this.getMap();\n    if (!map) {\n      return;\n    }\n    const view = map.getView();\n    if (!view) {\n      return;\n    }\n    const url = new URL(window.location.href);\n    const params = url.searchParams;\n\n    let updateView = false;\n\n    /**\n     * @type {import('../View.js').AnimationOptions}\n     */\n    const viewProperties = {};\n\n    const zoom = readNumber(this.get_(params, 'z'));\n    if (differentNumber(zoom, view.getZoom())) {\n      updateView = true;\n      viewProperties.zoom = zoom;\n    }\n\n    const rotation = readNumber(this.get_(params, 'r'));\n    if (differentNumber(rotation, view.getRotation())) {\n      updateView = true;\n      viewProperties.rotation = rotation;\n    }\n\n    const center = [\n      readNumber(this.get_(params, 'x')),\n      readNumber(this.get_(params, 'y')),\n    ];\n    if (differentArray(center, view.getCenter())) {\n      updateView = true;\n      viewProperties.center = center;\n    }\n\n    if (updateView) {\n      if (!this.initial_ && this.animationOptions_) {\n        view.animate(Object.assign(viewProperties, this.animationOptions_));\n      } else {\n        if (viewProperties.center) {\n          view.setCenter(viewProperties.center);\n        }\n        if ('zoom' in viewProperties) {\n          view.setZoom(viewProperties.zoom);\n        }\n        if ('rotation' in viewProperties) {\n          view.setRotation(viewProperties.rotation);\n        }\n      }\n    }\n\n    const layers = map.getAllLayers();\n    const layersParam = this.get_(params, 'l');\n    if (layersParam && layersParam.length === layers.length) {\n      for (let i = 0, ii = layers.length; i < ii; ++i) {\n        const value = parseInt(layersParam[i]);\n        if (!isNaN(value)) {\n          const visible = Boolean(value);\n          const layer = layers[i];\n          if (layer.getVisible() !== visible) {\n            layer.setVisible(visible);\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * @private\n   */\n  updateUrl_() {\n    const map = this.getMap();\n    if (!map) {\n      return;\n    }\n    const view = map.getView();\n    if (!view) {\n      return;\n    }\n    const initial = this.initial_;\n    this.initial_ = false;\n\n    const center = view.getCenter();\n    const zoom = view.getZoom();\n    const rotation = view.getRotation();\n\n    const layers = map.getAllLayers();\n    const visibilities = new Array(layers.length);\n    for (let i = 0, ii = layers.length; i < ii; ++i) {\n      visibilities[i] = layers[i].getVisible() ? '1' : '0';\n    }\n\n    const url = new URL(window.location.href);\n    const params = url.searchParams;\n\n    this.set_(params, 'x', writeNumber(center[0]));\n    this.set_(params, 'y', writeNumber(center[1]));\n    this.set_(params, 'z', writeNumber(zoom));\n    this.set_(params, 'r', writeNumber(rotation));\n    this.set_(params, 'l', visibilities.join(''));\n\n    if (url.href !== window.location.href) {\n      if (initial || this.replace_) {\n        window.history.replaceState(null, '', url);\n      } else {\n        window.history.pushState(null, '', url);\n      }\n    }\n  }\n}\n\nexport default Link;\n"],
  "mappings": "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",
  "names": []
}
